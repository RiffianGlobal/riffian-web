import{T as x,e as W,t as j,n as N,g as O,f as q,a as V,b as w}from"./index-jemeh5bG.js";import{x as o,g as I,q as A,d as v,c as b,I as E,K as M,M as K,N as L,O as S,P as J,a as P,n as g,y as T,h as l}from"./vendor-YHmzau40.js";const X='.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:#22243c}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,#fff0 8%,#fffc 36%,#fff0 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}';var H=Object.defineProperty,U=Object.getOwnPropertyDescriptor,$=(i,t,s,r)=>{for(var e=r>1?void 0:r?U(t,s):t,a=i.length-1,n;a>=0;a--)(n=i[a])&&(e=(r?n(t,s,e):n(e))||e);return r&&e&&H(t,s,e),e};let m=class extends x(X){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?o`<slot></slot>`:o`<div class="skeleton ${I(this.$c([this.class]))}">${A(this.groups,()=>o`<div class="p"></div>`)}</div>`}};$([v({type:Boolean})],m.prototype,"expect",2);$([v({type:Number})],m.prototype,"num",2);$([v({type:String})],m.prototype,"class",2);m=$([b("loading-skeleton")],m);var G=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,D=(i,t,s,r)=>{for(var e=r>1?void 0:r?Q(t,s):t,a=i.length-1,n;a>=0;a--)(n=i[a])&&(e=(r?n(t,s,e):n(e))||e);return r&&e&&G(t,s,e),e};let C=class extends x(""){constructor(){super(...arguments),this.type="inline"}render(){switch(this.type){case"block":return o`<div class="block mx-auto my-8 text-center text-xl"><i class="mdi mdi-loading mx-1"></i></div>`;default:return o`<i class="mdi mdi-loading mr-1"></i><slot>Loading...</slot>`}}};D([v({type:String})],C.prototype,"type",2);C=D([b("loading-icon")],C);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class Y extends M{constructor(){super(...arguments),this._$Cq=new K(this),this._$CK=new L}render(t,s){return S}update(t,[s,r]){if(this.isConnected||this.disconnected(),s===this._$CX)return;this._$CX=s;let e=0;const{_$Cq:a,_$CK:n}=this;return J(s,async u=>{for(;n.get();)await n.get();const h=a.deref();if(h!==void 0){if(h._$CX!==s)return!1;r!==void 0&&(u=r(u,e)),h.commitValue(u,e),e++}return!0}),S}commitValue(t,s){this.setValue(t)}disconnected(){this._$Cq.disconnect(),this._$CK.pause()}reconnected(){this._$Cq.reconnect(this),this._$CK.resume()}}const z=E(Y),_=async()=>q("MediaBoard",{account:await V()}),F=async()=>{const i=await _(),t="claimReward",s={},r=[y()];await W(s,i,t,r);const e=i[t](...r);return new j(e,{errorCodes:"MediaBoard",allowAlmostSuccess:!0,seq:{type:"ClaimAlbumRewards",title:"Claim Album Rewards",ts:N(),overrides:s}})},Z=async i=>{const t=await _(),s=await y(),r="userWeeklyVotes",e=[i,s];let a=await t[r](...e);const n="weeklyVotes",u=[s];let h=await t[n](...u);return h==0n?0:await B()*a/h},B=async()=>{const i=await _(),t="weeklyReward",s=[y()];return await i[t](...s)};var p=0n;const ee=async()=>await O("MediaBoard",`{
      statistic(id:"riffian") {
        week
      }
    }`),te=async i=>{let t=`{
      weeklyStatistic(id:"${i}") {
        volumeVote
      }
    }`;return await O("MediaBoard",t)},y=async()=>{if(p!=0n)return p;const i=7n*24n*60n*60n;try{let r=await(await _())["startTimeStamp"](),e=BigInt(new Date().getTime())/1000n;p=e-(e-r)%i}catch{let s=await ee(),r=BigInt(new Date().getTime())/1000n;p=BigInt(s.statistic.week),p=r-(r-p)%i}return p};var se=Object.defineProperty,ie=Object.getOwnPropertyDescriptor,d=(i,t,s,r)=>{for(var e=r>1?void 0:r?ie(t,s):t,a=i.length-1,n;a>=0;a--)(n=i[a])&&(e=(r?n(t,s,e):n(e))||e);return r&&e&&se(t,s,e),e};const R=()=>({load:"",tx:""});let c=class extends x(""){constructor(){super(...arguments),this.bindBridge=new P(this,w),this.userWeeklyReward=-1,this.tx=null,this.success=!1,this.pending=!1,this.pendingTx=!1,this.rewards=!1,this.err=R(),this.ts=0,this.resetState=()=>{this.err=R(),this.pending=!1,this.pendingTx=!1,this.success=!1,this.userWeeklyReward=-1,this.ts=0},this.close=async()=>{this.tx=null,this.resetState(),this.emit("close")},this.updateErr=(i={})=>this.err=Object.assign({},this.err,i)}get bridge(){return w.bridge}get emptyRewards(){return this.ts&&!(this.userWeeklyReward>0)}connectedCallback(){super.connectedCallback(),this.getPrice()}async getPrice(){this.pending=!0;try{this.userWeeklyReward=await Z(w.bridge.account)}catch(i){let t=i.message||i.code;this.updateErr({load:t})}finally{this.ts++,this.pending=!1}}async claim(){this.pendingTx=!0;try{this.tx=await F(),this.success=await this.tx.wait()}catch(i){console.log(i);let t=i.message||i.code;if(i.code===4001||i.code==="INVALID_ARGUMENT")return this.updateErr({tx:t}),this.close();/(Week not past)/.test(t)&&this.updateErr({tx:"Week is not past, please try later."})}finally{this.pendingTx=!1}}render(){return o`<ui-dialog @close="${()=>{this.close()}}"><p slot="header" class="w-full mr-2 text-base">Claim Rewards</p><div class="w-full h-[5.6rem] flex flex-col justify-center items-center self-center">${g(this.emptyRewards,()=>o`No rewards to claim yet.`,()=>o`${g(this.pending,()=>o`<div class="my-4"><loading-icon></loading-icon></div>`,()=>o`${g(this.pendingTx,()=>o`<tx-state .tx="${this.tx}" .opts="${{state:{success:"Success. Your claim request has been submitted."}}}"></tx-state>`,()=>o`<div class="text-base inline-flex items-center"><span class="text-2xl text-yellow-500 mr-2">${T(this.userWeeklyReward,18)}</span> rewards to claim.</div>${g(this.err.tx,()=>o`<div class="mt-1.5 text-red-500 text-sm opacity-70">${this.err.tx}</div>`)}`)}`)}`)}</div><div slot="bottom">${g(this.ts&&!this.emptyRewards,()=>o`<div class="flex justify-center items-center mx-4 py-4 border-t border-transparent" style="border-color:rgba(255,255,255,.12)"><ui-button ?disabled="${this.pendingTx}" ?pending="${this.pendingTx}" @click="${this.claim}">Claim<i class="mdi ${this.pending?"mdi-loading":""}"></i></ui-button></div>`)}</div></ui-dialog>`}};d([l()],c.prototype,"userWeeklyReward",2);d([l()],c.prototype,"tx",2);d([l()],c.prototype,"success",2);d([l()],c.prototype,"pending",2);d([l()],c.prototype,"pendingTx",2);d([l()],c.prototype,"rewards",2);d([l()],c.prototype,"err",2);d([l()],c.prototype,"ts",2);c=d([b("claim-reward-dialog")],c);const re=".text-highlight{color:var(--colorHighlight)}";var ae=Object.defineProperty,ne=Object.getOwnPropertyDescriptor,k=(i,t,s,r)=>{for(var e=r>1?void 0:r?ne(t,s):t,a=i.length-1,n;a>=0;a--)(n=i[a])&&(e=(r?n(t,s,e):n(e))||e);return r&&e&&ae(t,s,e),e};let f=class extends x(re){constructor(){super(...arguments),this.bindBridge=new P(this,w),this.rewards=0n,this.pending=!0,this.dialog=!1,this.timeCountDown=async function*(){const i=7n*24n*60n*60n;let t=await y(),s=0n;do{let r=BigInt(new Date().getTime())/1000n;s=t+i-r;let e=s/86400n,a=(s-e*86400n)/3600n,n=(s-e*86400n-a*3600n)/60n,u=s-e*86400n-a*3600n-n*60n;yield`${e?e.toString()+"D:":""}`+a.toString().padStart(2,"0")+"H:"+n.toString().padStart(2,"0")+"m:"+u.toString().padStart(2,"0")+"s",await new Promise(h=>setTimeout(h,1e3))}while(s>1)},this.open=()=>this.dialog=!0,this.close=()=>this.dialog=!1}get disabled(){return!w.bridge.account}connectedCallback(){super.connectedCallback(),this.weeklyRewards()}async weeklyRewards(){var i;try{this.pending=!0;try{this.rewards=await B()}catch{let s=await te(await y());this.rewards=BigInt(((i=s.weeklyStatistic)==null?void 0:i.volumeVote)??0)*4n/100n}this.pending=!1}catch(t){console.error("claim",t)}}render(){return o`<div class="text-right"><div class="font-light text-2xl text-highlight">${g(this.pending,()=>o`<i class="text-lg mdi mdi-loading"></i>`,()=>o`<ui-button icon class="ml-1 mx-auto sm" @click="${this.open}" ?disabled="${this.disabled}" title="Claim"><i class="mdi mdi-hand-coin-outline"></i></ui-button>${T(this.rewards,18)}`)}</div><div class="text-green-500 mt-2">${z(this.timeCountDown())}</div></div>${g(this.dialog,()=>o`<claim-reward-dialog @close="${this.close}"></claim-reward-dialog>`)}`}};k([l()],f.prototype,"rewards",2);k([l()],f.prototype,"pending",2);k([l()],f.prototype,"dialog",2);f=k([b("claim-rewards")],f);export{y as g,z as h};
