import{T as m,b as g,a as w,u as _,c as j,d as P,e as O}from"./index-4Y4c3ejC.js";import{c as $,x as l,n as h,K as V,h as c,a as v,b,e as C,a0 as S,d as E,q as f}from"./vendor-aecOC4Ab.js";import"./icon-C9bbqVue.js";var A=Object.defineProperty,D=Object.getOwnPropertyDescriptor,d=(e,s,r,i)=>{for(var t=i>1?void 0:i?D(s,r):s,a=e.length-1,o;a>=0;a--)(o=e[a])&&(t=(i?o(s,r,t):o(t))||t);return i&&t&&A(s,r,t),t};const y=()=>({tx:""});let n=class extends m(""){constructor(){super(...arguments),this.bindBridge=new $(this,g),this.album="",this.url="",this.votes=0,this.price=0,this.tx=null,this.success=!1,this.pending=!1,this.rewards=!1,this.err=y(),this.resetState=()=>{this.err=y(),this.pending=!1,this.success=!1,this.price=0},this.close=async()=>{this.tx=null,this.resetState(),this.emit("close")},this.updateErr=(e={})=>this.err=Object.assign({},this.err,e)}connectedCallback(){super.connectedCallback(),this.getPrice()}async getPrice(){try{let e=await _(this.album,await w());this.votes=e,this.price=await j(this.album,this.votes)}catch(e){let s=e.message||e.code;this.updateErr({tx:s})}}async retreat(){this.pending=!0;try{this.tx=await P(this.album,this.votes),this.success=await this.tx.wait()}catch(e){let s=e.message||e.code;if(e.code===4001)return this.updateErr({tx:s}),this.close()}finally{}}render(){return l`<ui-dialog @close="${()=>{this.close()}}"><p slot="header" class="my-2 font-bold">Retreat Subject</p><div class="grid place-items-center b-1 border m-4 p-4 rounded-md"><p class="w-36 h-36"><img-loader src="${this.url}"></img-loader></p>${h(!this.price,()=>l`<div class="my-4"><loading-skeleton num="3"></loading-skeleton><p class="my-4">Loading subject data...</p></div>`)} ${h(this.price&&!this.pending,()=>l`<p class="font-bold">Estimated returned value</p><p class="text-xl text-sky-500">${V(this.price,18)} FTM</p><p>Your Votes:${this.votes}</p><ui-button class="m-1" @click="${this.retreat}">RETREAT</ui-button>`)}${h(this.pending,()=>l`<tx-state .tx="${this.tx}" .opts="${{state:{success:"Success. Your retreat has been submitted."}}}"><ui-button slot="view" href="/">Close</ui-button></tx-state>`)}</div></ui-dialog>`}};d([v({type:String})],n.prototype,"album",2);d([v({type:String})],n.prototype,"url",2);d([v({type:Number})],n.prototype,"votes",2);d([c()],n.prototype,"price",2);d([c()],n.prototype,"tx",2);d([c()],n.prototype,"success",2);d([c()],n.prototype,"pending",2);d([c()],n.prototype,"rewards",2);d([c()],n.prototype,"err",2);n=d([b("retreat-vote-dialog")],n);const T=".ui-list .item{cursor:pointer;align-items:center}@media (min-width: 768px){.ui-list .name{font-size:1rem;line-height:1.5rem}}.ui-list .author{width:13rem;text-align:right}";var L=Object.defineProperty,M=Object.getOwnPropertyDescriptor,p=(e,s,r,i)=>{for(var t=i>1?void 0:i?M(s,r):s,a=e.length-1,o;a>=0;a--)(o=e[a])&&(t=(i?o(s,r,t):o(t))||t);return i&&t&&L(s,r,t),t};let u=class extends m(T){constructor(){super(...arguments),this.bindBridge=new $(this,g),this.by="",this.dir="",this.uVotes=[],this.dialog=!1,this.currentAlbum={id:"",votes:0,url:""},this.pending=!1,this.init=async()=>{if(!this.disabled){this.pending=!0;try{const e=await O("",{orderBy:this.by});this.uVotes=e}catch{}finally{this.pending=!1}}},this.close=()=>this.dialog=!1,this.go2=e=>{this.disabled?C.emit("connect-wallet"):S(`/track/${e.subject.id}`)}}get disabled(){return!g.bridge.account}async connectedCallback(){super.connectedCallback(),this.init(),g.bridge.subscribe(this.init)}getRandomInt(e){return Math.floor(Math.random()*e)}render(){return l`<div role="list" class="ui-list ${E(this.$c([this.pending?"loading":"hover"]))}"><div class="flex header"><div class="flex-auto">Collection</div><div class="author flex-none w-32 text-right">Author</div><div class="num flex-none">Tickets</div><div class="num flex-none">Holding</div></div>${h(this.pending,()=>l`<div name="Loading" class="doc-intro"><div class="flex flex-col gap-8 m-6">${f([...Array(3).keys()],()=>l`<div name="Loading" class="doc-intro"><loading-skeleton num="4"></loading-skeleton></div>`)}</div></div>`,()=>l`${f(this.uVotes,(e,s)=>l`<div class="item flex items-center pr-0.5" @click="${()=>this.go2(e)}"><div class="flex-auto flex items-center"><img-loader .src="${e.subject.image}" class="w-[3.25rem] h-[3.25rem] rounded-lg mr-4"></img-loader><div><p class="name truncate mb-0.5">${e.subject.name}</p>${h(e.subject.uri,()=>l`<a href="${e.subject.uri}" target="_blank"><span class="icon mt-1"><i class="mdi mdi-play-circle-outline text-lg opacity-80 hover_opacity-100"></i></span></a>`)}</div></div><div class="author flex-none text-right"><ui-address .address="${e.subject.creator.address}" short avatar></ui-address></div><div class="num flex-none font-light">${e.subject.supply}</div><div class="num flex-none font-light">${e.holding}</div></div>`)}`)}</div>`}};p([v()],u.prototype,"by",2);p([v()],u.prototype,"dir",2);p([c()],u.prototype,"uVotes",2);p([c()],u.prototype,"dialog",2);p([c()],u.prototype,"currentAlbum",2);p([c()],u.prototype,"pending",2);u=p([b("user-votes-list")],u);const R="";var B=Object.defineProperty,U=Object.getOwnPropertyDescriptor,Y=(e,s,r,i)=>{for(var t=i>1?void 0:i?U(s,r):s,a=e.length-1,o;a>=0;a--)(o=e[a])&&(t=(i?o(s,r,t):o(t))||t);return i&&t&&B(s,r,t),t};let x=class extends m(R){render(){return l`<div class="ui-container mx-auto flex flex-col place-content-center pt-12"><div><div class="w-full inline-flex pb-6 border-b border-slate-50/10"><div class="py-1.5 px-3 text-base font-normal bg-sky-300/10 text-white/70 rounded-md">My Votes</div></div></div><user-votes-list by="id"></user-votes-list></div>`}};x=Y([b("user-votes")],x);export{x as ViewTop};
