import{a as b,t as j,n as _,g as C,c as O,T as v,b as h}from"./index-tq4ZD4lb.js";import{g as P}from"./claim-IdcAhX-Y.js";import{a as $,x as n,c as u,u as S,f as l,d as m,b as f,h as V}from"./vendor-od9KRoES.js";const y=async()=>C("MediaBoard",{account:await O()}),E=async(t,s)=>{const a=await y(),r="getRetreatPrice",e={},i=[t,s];return await b(e,a,r,i),await a[r](...i)},A=async(t,s)=>{const a=await y(),r="userSubjectVotes",e={},i=[t,s];return await b(e,a,r,i),await a[r](...i)},R=async(t,s)=>{const a=await y(),r="retreat",e={},i=[t,s];await b(e,a,r,i);const o=a[r](...i);return new j(o,{errorCodes:"MediaBoard",allowAlmostSuccess:!0,seq:{type:"RetreatSubject",title:"Retreat Subject",ts:_(),overrides:e}})},T=async t=>{let s=`{
      userSubjectVotes(where:{holding_gt:0,user:"${t.toLowerCase()}"}) {
        holding
        votes
        subject {
          id
          name
          image
          uri
          supply
          creator{
            address
          }
        }
      }
    }`;return await P("MediaBoard",s)};var D=Object.defineProperty,M=Object.getOwnPropertyDescriptor,d=(t,s,a,r)=>{for(var e=r>1?void 0:r?M(s,a):s,i=t.length-1,o;i>=0;i--)(o=t[i])&&(e=(r?o(s,a,e):o(e))||e);return r&&e&&D(s,a,e),e};const w=()=>({tx:""});let c=class extends v(""){constructor(){super(...arguments),this.bindBridge=new $(this,h),this.album="",this.url="",this.votes=0,this.price=0,this.tx=null,this.success=!1,this.pending=!1,this.rewards=!1,this.err=w(),this.resetState=()=>{this.err=w(),this.pending=!1,this.success=!1,this.price=0},this.close=async()=>{this.tx=null,this.resetState(),this.emit("close")},this.updateErr=(t={})=>this.err=Object.assign({},this.err,t)}connectedCallback(){super.connectedCallback(),this.getPrice()}async getPrice(){try{let t=await A(this.album,h.bridge.account);this.votes=t,this.price=await E(this.album,this.votes)}catch(t){let s=t.message||t.code;this.updateErr({tx:s})}}async retreat(){this.pending=!0;try{this.tx=await R(this.album,this.votes),this.success=await this.tx.wait()}catch(t){let s=t.message||t.code;if(t.code==="ACTION_REJECTED")return this.updateErr({tx:s}),this.close()}finally{}}render(){return n`<ui-dialog @close="${()=>{this.close()}}"><p slot="header" class="my-2 font-bold">Retreat Subject</p><div class="grid place-items-center b-1 border m-4 p-4 rounded-md"><p class="w-36 h-36"><img-loader src="${this.url}"></img-loader></p>${u(!this.price,()=>n`<div class="my-4"><loading-skeleton num="3"></loading-skeleton><p class="my-4">Loading subject data...</p></div>`)} ${u(this.price&&!this.pending,()=>n`<p class="font-bold">Estimated returned value</p><p class="text-xl text-sky-500">${S(this.price,18)} FTM</p><p>Your Votes:${this.votes}</p><ui-button class="m-1" @click="${this.retreat}">RETREAT</ui-button>`)}${u(this.pending,()=>n`<tx-state .tx="${this.tx}" .opts="${{state:{success:"Success. Your retreat has been submit."}}}"><ui-button slot="view" href="/">Close</ui-button></tx-state>`)}</div></ui-dialog>`}};d([m({type:String})],c.prototype,"album",2);d([m({type:String})],c.prototype,"url",2);d([m({type:Number})],c.prototype,"votes",2);d([l()],c.prototype,"price",2);d([l()],c.prototype,"tx",2);d([l()],c.prototype,"success",2);d([l()],c.prototype,"pending",2);d([l()],c.prototype,"rewards",2);d([l()],c.prototype,"err",2);c=d([f("retreat-vote-dialog")],c);var B=Object.defineProperty,L=Object.getOwnPropertyDescriptor,g=(t,s,a,r)=>{for(var e=r>1?void 0:r?L(s,a):s,i=t.length-1,o;i>=0;i--)(o=t[i])&&(e=(r?o(s,a,e):o(e))||e);return r&&e&&B(s,a,e),e};let p=class extends v(""){constructor(){super(...arguments),this.bindBridge=new $(this,h),this.userVotes=[],this.dialog=!1,this.currentAlbum={id:"",votes:0,url:""},this.pending=!1,this.init=async()=>{this.pending=!0;let t=await T(h.bridge.account);this.userVotes=t.userSubjectVotes,this.pending=!1},this.close=()=>this.dialog=!1}get disabled(){return!h.bridge.account}connectedCallback(){super.connectedCallback(),this.init()}getRandomInt(t){return Math.floor(Math.random()*t)}render(){return n`<div class="grid place-items-center b-1 m-4 p-4 rounded-md">${u(this.pending,()=>n`<div name="Loading" class="doc-intro"><div class="flex flex-col gap-8 m-8"><loading-skeleton num="3"></loading-skeleton></div></div>`)} ${u(!this.pending,()=>n`<table class="w-full text-left border-collapse"><thead><th>Collection</th><th>Name</th><th>Author</th><th>Current Retreat Price</th><th>Holding</th><th>Operation</th></thead>${V(this.userVotes,t=>n`<tr><td><p class="w-24 h-24 rounded-md"><img-loader src="${t.subject.image}" loading="lazy"></img-loader></p></td><td class="py-2 pl-2 text-lg leading-6 whitespace-pre dark:text-indigo-300 font-sans">${t.subject.name}</td><td><ui-address .address="${t.subject.creator.address}" short avatar></ui-address></td><td><p class="text-sm font-bold font-sans">${t.subject.supply/10}</p></td><td><p class="text-lg font-bold text-sky-500 font-sans">${t.holding}</p></td><td><div name="Dialog" class="doc-intro"><ui-button class="outlined" ?disabled="${this.disabled}" @click="${()=>{this.currentAlbum=t.subject,this.dialog=!0}}">RETREAT</ui-button>${u(this.dialog&&t.subject.id==this.currentAlbum.id,()=>n`<retreat-vote-dialog album="${t.subject.id}" url="${t.subject.image}" votes="${t.subject.supply}" @close="${this.close}"></retreat-vote-dialog>`)}</div></td></tr>`)}</table>`)}</div>`}};g([l()],p.prototype,"userVotes",2);g([l()],p.prototype,"dialog",2);g([l()],p.prototype,"currentAlbum",2);g([l()],p.prototype,"pending",2);p=g([f("user-votes-list")],p);const N="";var q=Object.defineProperty,I=Object.getOwnPropertyDescriptor,J=(t,s,a,r)=>{for(var e=r>1?void 0:r?I(s,a):s,i=t.length-1,o;i>=0;i--)(o=t[i])&&(e=(r?o(s,a,e):o(e))||e);return r&&e&&q(s,a,e),e};let x=class extends v(N){render(){return n`<div class="top"><div class="ui-container relative flex justify-between items-center"><div class="flex items-center gap-3 lg_gap-4 lg_w-40"><p class="font-bold text-xl">My Votes</p></div></div><div class="ui-container"><user-votes-list></user-votes-list></div></div>`}};x=J([f("user-votes")],x);export{x as ViewTop};
