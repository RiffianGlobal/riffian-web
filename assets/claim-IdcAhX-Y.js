import{N as C,T as b,a as W,t as q,n as A,g as V,c as L,b as y}from"./index-tq4ZD4lb.js";import{x as o,e as M,h as U,d as v,b as x,z as G,A as J,D as H,E as K,G as O,H as X,a as E,c as g,u as B,f as l}from"./vendor-od9KRoES.js";const z=function(s){let{status:t,statusText:e}=s;if(s.ok)return s;e||(e+=t);let r=new Error(e);throw Object.assign(r,{raw:s,code:t,message:e}),r},F=function(s){const t=s.headers.get("content-type");return/^image\//.test(t)?s.blob():/^(text)\//.test(t)?s.text():s.json().catch(function(e){throw e}).then(function(e){const r=e.data??e.result??e,a=e.error_code??r.error_code??r.code??r.error??e.code??(r.errors?"Errors":void 0)??s.status;if(a&&![200].includes(a)){const i=r.error_message||r.error_msg||r.message||r.msg||e.msg||e.message||e.data||(r.errors??[]).map(n=>n.message).join(`

`);throw Object.assign(new Error(a),{code:a,message:i,raw:s})}return r})},S=async function(s,t={}){const e={method:"GET",headers:{accept:"application/json, */*"},mode:"cors",credentials:"same-origin"};return Object.assign(t,e,{...t}),t.headers&&Object.assign(t.headers,e.headers,{...t.headers}),fetch(s,t).then(z).then(F).catch(function(r){throw r})},Q=s=>!/^(?:[a-z+]+:)?\/\//.test(s),Y=s=>Q(s)?location.origin+(/^\//.test(s)?"":location.pathname):s,P=function(s,t={}){const e=new URL(s,Y(s));for(let r in t)e.searchParams.set(r,t[r]);return e.toString()};class Z{constructor(){this.fetch=S}get(t,e={},r){return S(P(t,e),r)}post(t,e={},{method:r="POST",form:a=!1,search:i=!1,headers:n={}}={}){const c=a?new URLSearchParams(e).toString():JSON.stringify(e);return S(i?P(t,e):t,{method:r,headers:{"Content-Type":a?"application/x-www-form-urlencoded":"application/json",...n},body:c})}delete(t,e={},r={}){return this.post(t,e,{...r,method:"DELETE"})}}const tt=new Z,D={main:{"0x1":"https://api.studio.thegraph.com/query/","0xaa36a7":"https://api.studio.thegraph.com/query/","0x5":"https://api.studio.thegraph.com/query/"},MediaBoard:{"0xfa2":"https://api.thegraph.com/subgraphs/name/pho360360/riffianboard"}},et=s=>{let t=D[s][C.chainId];return t||(console.error(`Not available for selected network(chain id ${C.chainId}). Fallback to default chainid`),t=D[s][C.defaultChainId]),t},j=async(s="main",t,e,r)=>tt.post(et(s),{query:t,variables:e,operationName:r}),st='.skeleton{display:inline-flex;height:100%;width:100%;flex-direction:column;gap:1rem}.p{height:100%;width:6rem;overflow:hidden;border-radius:.375rem;height:1em;background:#dee2e6}.p:after{content:"";display:block;height:100%;width:100%;background:linear-gradient(90deg,#fff0 8%,#fffc 36%,#fff0 66%) 0% 0% / 1200px;animation:skeleton 3s ease-in-out infinite}.p:nth-child(2){width:9rem}.p:nth-child(3){width:12rem}@keyframes skeleton{0%{background-position:-1200px 0}to{background-position:1200px 0}}';var rt=Object.defineProperty,at=Object.getOwnPropertyDescriptor,$=(s,t,e,r)=>{for(var a=r>1?void 0:r?at(t,e):t,i=s.length-1,n;i>=0;i--)(n=s[i])&&(a=(r?n(t,e,a):n(a))||a);return r&&a&&rt(t,e,a),a};let w=class extends b(st){constructor(){super(...arguments),this.expect=!1,this.num=1,this.class=""}get groups(){return new Array(this.num)}render(){return this.expect?o`<slot></slot>`:o`<div class="skeleton ${M(this.$c([this.class]))}">${U(this.groups,()=>o`<div class="p"></div>`)}</div>`}};$([v({type:Boolean})],w.prototype,"expect",2);$([v({type:Number})],w.prototype,"num",2);$([v({type:String})],w.prototype,"class",2);w=$([x("loading-skeleton")],w);var it=Object.defineProperty,nt=Object.getOwnPropertyDescriptor,N=(s,t,e,r)=>{for(var a=r>1?void 0:r?nt(t,e):t,i=s.length-1,n;i>=0;i--)(n=s[i])&&(a=(r?n(t,e,a):n(a))||a);return r&&a&&it(t,e,a),a};let R=class extends b(""){constructor(){super(...arguments),this.type="inline"}render(){switch(this.type){case"block":return o`<div class="block mx-auto my-8 text-center text-xl"><i class="mdi mdi-loading mx-1"></i></div>`;default:return o`<i class="mdi mdi-loading mr-1"></i><slot>Loading...</slot>`}}};N([v({type:String})],R.prototype,"type",2);R=N([x("loading-icon")],R);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class ot extends J{constructor(){super(...arguments),this._$Cq=new H(this),this._$CK=new K}render(t,e){return O}update(t,[e,r]){if(this.isConnected||this.disconnected(),e===this._$CX)return;this._$CX=e;let a=0;const{_$Cq:i,_$CK:n}=this;return X(e,async c=>{for(;n.get();)await n.get();const d=i.deref();if(d!==void 0){if(d._$CX!==e)return!1;r!==void 0&&(c=r(c,a)),d.commitValue(c,a),a++}return!0}),O}commitValue(t,e){this.setValue(t)}disconnected(){this._$Cq.disconnect(),this._$CK.pause()}reconnected(){this._$Cq.reconnect(this),this._$CK.resume()}}const ct=G(ot),_=async()=>V("MediaBoard",{account:await L()}),lt=async()=>{const s=await _(),t="claimReward",e={},r=[m()];await W(e,s,t,r);const a=s[t](...r);return new q(a,{errorCodes:"MediaBoard",allowAlmostSuccess:!0,seq:{type:"ClaimAlbumRewards",title:"Claim Album Rewards",ts:A(),overrides:e}})},dt=async s=>{const t=await _(),e=await m(),r="userWeeklyVotes",a=[s,e];let i=await t[r](...a);const n="weeklyVotes",c=[e];let d=await t[n](...c);return d==0n?0:await I()*i/d},I=async()=>{const s=await _(),t="weeklyReward",e=[m()];return await s[t](...e)};var u=0n;const ht=async()=>await j("MediaBoard",`{
      statistic(id:"riffian") {
        week
      }
    }`),ut=async s=>{let t=`{
      weeklyStatistic(id:"${s}") {
        volumeVote
      }
    }`;return await j("MediaBoard",t)},m=async()=>{if(u!=0n)return u;const s=7n*24n*60n*60n;try{let r=await(await _())["startTimeStamp"](),a=BigInt(new Date().getTime())/1000n;u=a-(a-r)%s}catch{let e=await ht(),r=BigInt(new Date().getTime())/1000n;u=BigInt(e.statistic.week),u=r-(r-u)%s}return u};var pt=Object.defineProperty,gt=Object.getOwnPropertyDescriptor,p=(s,t,e,r)=>{for(var a=r>1?void 0:r?gt(t,e):t,i=s.length-1,n;i>=0;i--)(n=s[i])&&(a=(r?n(t,e,a):n(a))||a);return r&&a&&pt(t,e,a),a};const T=()=>({tx:""});let h=class extends b(""){constructor(){super(...arguments),this.bindBridge=new E(this,y),this.userWeeklyReward=-1,this.tx=null,this.success=!1,this.pending=!1,this.rewards=!1,this.err=T(),this.resetState=()=>{this.err=T(),this.pending=!1,this.success=!1,this.userWeeklyReward=0},this.close=async()=>{this.tx=null,this.resetState(),this.emit("close")},this.updateErr=(s={})=>this.err=Object.assign({},this.err,s)}connectedCallback(){super.connectedCallback(),this.getPrice()}async getPrice(){try{this.userWeeklyReward=await dt(y.bridge.account)}catch(s){let t=s.message||s.code;this.updateErr({tx:t})}finally{}}async claim(){this.pending=!0;try{this.tx=await lt(),this.success=await this.tx.wait()}catch(s){console.log(s);let t=s.message||s.code;if(s.code==="ACTION_REJECTED"||s.code==="INVALID_ARGUMENT")return this.updateErr({tx:t}),this.close()}finally{this.pending=!1}}render(){return o`<ui-dialog @close="${()=>{this.close()}}"><p slot="header" class="my-2 font-bold">Claim Rewards</p><div class="grid place-items-center b-1 border m-4 p-4 rounded-md">${g(!(this.userWeeklyReward>=0),()=>o`<div class="my-4"><loading-icon></loading-icon></div>`)} ${g(this.userWeeklyReward>=0&&!this.pending,()=>o`<p class="font-bold">Reward Value</p><p class="text-xl text-sky-500">${B(this.userWeeklyReward,18)} FTM</p><ui-button ?disabled="${this.userWeeklyReward<=0}" class="m-1" @click="${this.claim}">CLAIM</ui-button>`)}${g(this.pending,()=>o`<tx-state .tx="${this.tx}" .opts="${{state:{success:"Success. Your claim request has been submit."}}}"><ui-button slot="view" href="/">Close</ui-button></tx-state>`)}</div></ui-dialog>`}};p([l()],h.prototype,"userWeeklyReward",2);p([l()],h.prototype,"tx",2);p([l()],h.prototype,"success",2);p([l()],h.prototype,"pending",2);p([l()],h.prototype,"rewards",2);p([l()],h.prototype,"err",2);h=p([x("claim-reward-dialog")],h);const wt=".text-highlight{color:var(--colorHighlight)}";var mt=Object.defineProperty,ft=Object.getOwnPropertyDescriptor,k=(s,t,e,r)=>{for(var a=r>1?void 0:r?ft(t,e):t,i=s.length-1,n;i>=0;i--)(n=s[i])&&(a=(r?n(t,e,a):n(a))||a);return r&&a&&mt(t,e,a),a};let f=class extends b(wt){constructor(){super(...arguments),this.bindBridge=new E(this,y),this.rewards=0n,this.pending=!0,this.dialog=!1,this.timeCountDown=async function*(){const s=7n*24n*60n*60n;let t=await m(),e=0n;do{let r=BigInt(new Date().getTime())/1000n;e=t+s-r;let a=e/86400n,i=(e-a*86400n)/3600n,n=(e-a*86400n-i*3600n)/60n,c=e-a*86400n-i*3600n-n*60n;yield a.toString()+"D "+i.toString().padStart(2,"0")+"H "+n.toString().padStart(2,"0")+"M "+c.toString().padStart(2,"0"),await new Promise(d=>setTimeout(d,1e3))}while(e>1)},this.open=()=>this.dialog=!0,this.close=()=>this.dialog=!1}get disabled(){return!y.bridge.account}connectedCallback(){super.connectedCallback(),this.weeklyRewards()}async weeklyRewards(){try{this.pending=!0;try{this.rewards=await I()}catch{let t=await ut(await m());this.rewards=BigInt(t.weeklyStatistic.volumeVote)*4n/100n}this.pending=!1}catch(s){console.error("claim",s)}}render(){return o`<div class="text-right"><div class="font-light text-2xl text-highlight">${g(this.pending,()=>o`<i class="text-lg mdi mdi-loading"></i>`,()=>o`<ui-button icon class="ml-1 mx-auto sm" @click="${this.open}" ?disabled="${this.disabled}" title="Claim"><i class="mdi mdi-hand-coin-outline"></i></ui-button>${B(this.rewards,18)}`)}</div><div class="font-light text-green-500 mt-2">${ct(this.timeCountDown())}</div></div>${g(this.dialog,()=>o`<claim-reward-dialog @close="${this.close}"></claim-reward-dialog>`)}`}};k([l()],f.prototype,"rewards",2);k([l()],f.prototype,"pending",2);k([l()],f.prototype,"dialog",2);f=k([x("claim-rewards")],f);export{m as a,j as g,ct as h};
