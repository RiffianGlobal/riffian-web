import{a as v,t as E,n as V,b as k,g as q,c as G,T as R,U as W}from"./index-tq4ZD4lb.js";import{g as N}from"./claim-IdcAhX-Y.js";import{w as Y,y as z,S as Q,p as H,a as T,u as I,x as u,c as P,v as x,f as d,d as w,b as A,l as K,m as X}from"./vendor-od9KRoES.js";var _={exports:{}};(function(t,e){(function(o,r){r(e,t)})(Y,function(o,r){var s={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function i(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function a(h){try{delete window[h]}catch{window[h]=void 0}}function y(h){var l=document.getElementById(h);l&&document.getElementsByTagName("head")[0].removeChild(l)}function U(h){var l=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],$=h,J=l.timeout||s.timeout,D=l.jsonpCallback||s.jsonpCallback,f=void 0;return new Promise(function(M,j){var m=l.jsonpCallbackFunction||i(),b=D+"_"+m;window[m]=function(L){M({ok:!0,json:function(){return Promise.resolve(L)}}),f&&clearTimeout(f),y(b),a(m)},$+=$.indexOf("?")===-1?"?":"&";var p=document.createElement("script");p.setAttribute("src",""+$+D+"="+m),l.charset&&p.setAttribute("charset",l.charset),l.nonce&&p.setAttribute("nonce",l.nonce),l.referrerPolicy&&p.setAttribute("referrerPolicy",l.referrerPolicy),l.crossorigin&&p.setAttribute("crossorigin","true"),p.id=b,document.getElementsByTagName("head")[0].appendChild(p),f=setTimeout(function(){j(new Error("JSONP request to "+h+" timed out")),a(m),y(b),window[m]=function(){a(m)}},J),p.onerror=function(){j(new Error("JSONP request to "+h+" failed")),a(m),y(b),f&&clearTimeout(f)}})}r.exports=U})})(_,_.exports);var Z=_.exports;const tt=z(Z),g=async()=>q("MediaBoard",{account:await G()}),et=async(t,e,o)=>{const r=await g(),s="vote",i={},a=[t,e,o];await v(i,r,s,a);const y=r[s](...a);return new E(y,{errorCodes:"MediaBoard",allowAlmostSuccess:!0,seq:{type:"VoteSubject",title:"Vote Subject",ts:V(),overrides:i}})},st=async t=>{try{console.log("URI:"+t),t="https://twitter.com/archdeaconsal/status/1732505736616563171",console.log("url:https://publish.twitter.com/oembed?url="+encodeURIComponent(t));let e=await tt("https://publish.twitter.com/oembed?url="+encodeURIComponent(t));return console.log(e.json()),e.json()}catch(e){console.log(e)}},ot=async t=>{try{const e=await g();console.log("addr->"+t);const o="getSocials",r=[t];return(await e[o](...r))[0][2]}catch(e){console.log(e)}},rt=async(t,e)=>{const o=await g(),r="retreat",s={},i=[t,e];await v(s,o,r,i);const a=o[r](...i);return new E(a,{errorCodes:"MediaBoard",allowAlmostSuccess:!0,seq:{type:"RetreatSubject",title:"Retreat Subject",ts:V(),overrides:s}})},it=async t=>{const e=await g(),o="subjectToData",r={},s=[t];return await v(r,e,o,s),await e[o](...s)},at=async t=>{const e=await g(),o="userSubjectVotes",r={},s=[t,k.bridge.account];return await v(r,e,o,s),await e[o](...s)},ct=async t=>{const e=await g(),o="getRetreatPrice",r={},s=[t,1];return await v(r,e,o,s),await e[o](...s)},nt=async t=>{const e=await g(),o="getVotePrice",r={},s=[t,1];return await v(r,e,o,s),await e[o](...s)},lt=async t=>{const e=await g(),o="getVotePriceWithFee",r={},s=[t,1];return await v(r,e,o,s),await e[o](...s)},$t=async(t,e)=>{const o=24n*60n*60n;let r=BigInt(new Date().getTime())/1000n-o,s=`{
      subjectWeeklyVotes(first: ${t}, where:{week:${e}}, orderBy: volumeTotal, orderDirection:desc) {
        id
        volumeTotal
        subject {
          id
          name
          image
          uri
          supply
          creator {
            address
          }
          voteLogs(first:1, where:{time_lt:${r}} orderBy:time, orderDirection:desc){
            supply
          }
        }
      }
    }`;return await N("MediaBoard",s)},St=async t=>{const e=24n*60n*60n;let o=BigInt(new Date().getTime())/1000n-e,r=`{
      subjects(first: ${t}, orderBy:supply, orderDirection:desc) {
        id
        image
        name
        uri
        supply
        creator {
          address
        }
        voteLogs(first:1, where:{time_lt:${o}} orderBy:time, orderDirection:desc){
          supply
        }
      }
    }`;return await N("MediaBoard",r)};var dt=Object.defineProperty,ut=Object.getOwnPropertyDescriptor,ht=(t,e,o,r)=>{for(var s=r>1?void 0:r?ut(e,o):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(s=(r?a(e,o,s):a(s))||s);return r&&s&&dt(e,o,s),s};class B extends Q{constructor(){super(),this.key="",this.key="tweets",this.sync()}sync(){this.tweets=JSON.parse(localStorage.getItem(this.key)||"[]")}save(){this.tweets=[...this.tweets],localStorage.setItem(this.key,JSON.stringify(this.tweets))}}ht([H({value:[]})],B.prototype,"tweets",2);const S=new B;var mt=Object.defineProperty,pt=Object.getOwnPropertyDescriptor,n=(t,e,o,r)=>{for(var s=r>1?void 0:r?pt(e,o):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(s=(r?a(e,o,s):a(s))||s);return r&&s&&mt(e,o,s),s};const O=()=>({tx:""});let c=class extends R(""){constructor(){super(...arguments),this.bindBridge=new T(this,k),this.bindTweets=new T(this,S),this.album="",this.url="",this.name="",this.author="",this.retreatDisabled=!0,this.socialName="",this.socialURI="",this.socialID="",this.socialVerified=!1,this.tx=null,this.success=!1,this.pending=!1,this.rewards=!1,this.err=O(),this.resetState=()=>{this.err=O(),this.pending=!1,this.success=!1,this.price=void 0,this.votes=void 0},this.close=async()=>{this.tx=null,this.resetState(),this.emit("close")},this.updateErr=(t={})=>this.err=Object.assign({},this.err,t)}connectedCallback(){super.connectedCallback(),this.getPrice(),this.readFromTwitter()}get tweets(){return S.tweets}readFromLocal(t){let e={key:"",author_name:"",author_url:"",html:""};return this.tweets.some(o=>{o.key==t&&(e=o)}),e}async readFromTwitter(){let t=await ot(this.author),e=this.readFromLocal(t);console.log("Read tweet from localStorage"),e.key.length==0&&(e=await st(this.author),e.key=t,this.tweets.unshift(e),S.save()),this.socialName=e.author_name,this.socialURI=e.author_url,this.socialID=e.author_url.substring(e.author_url.lastIndexOf("/")+1,e.author_url.length-1),console.log(this.socialID),this.socialVerified=e.html.includes(this.author),this.socialVerified=!0}async getPrice(){try{this.votes=it(this.album).then(t=>t[4]),this.myVotes=at(this.album).then(t=>(t>0&&(this.retreatDisabled=!1),t)),this.price=nt(this.album).then(t=>I(t,18)),this.retreatPrice=ct(this.album).then(t=>I(t,18))}catch(t){let e=t.message||t.code;this.updateErr({tx:e})}}async vote(){this.pending=!0;try{this.tx=await et(this.album,1,{value:(await lt(this.album))[0]}),this.success=await this.tx.wait()}catch(t){console.log(t);let e=t.message||t.code;(t.code==="ACTION_REJECTED"||t.code==="INVALID_ARGUMENT")&&(this.updateErr({tx:e}),this.pending=!1)}finally{}}async retreat(){this.pending=!0;try{this.tx=await rt(this.album,1),this.success=await this.tx.wait()}catch(t){console.log(t);let e=t.message||t.code;(t.code==="ACTION_REJECTED"||t.code==="INVALID_ARGUMENT")&&(this.updateErr({tx:e}),this.pending=!1)}finally{}}render(){return u`<ui-dialog @close="${()=>{this.close()}}"><p slot="header" class="font-bold">VOTE Track</p><div slot="center" class="flex mx-4 mt-4"><div class="flex grow pb-4"><div class="w-24 mr-4"><img-loader src="${this.url}"></img-loader></div><div><div class="text-lg font-bold">${this.name}</div><div><div class="text-sm font-light text-blue-300">${P(this.socialVerified,()=>u`<span><i class="text-green-600 text-sm mdi mdi-check-decagram"></i></span>`)}${this.socialName}</div><div class="text-sm font-light text-blue-300"><a href="${this.socialURI}" target="_blank">@${this.socialID}</a></div></div><div class="text-gray-500">You own ${x(this.myVotes,u`<i class="text-sm mdi mdi-loading"></i>`)} tickets</div></div></div><div class="text-right"><span class="text-lg text-sky-500">${x(this.votes,u`<i class="text-sm mdi mdi-loading"></i>`)}</span><div class="text-sm text-gray-500">Tickets</div><span class="text-lg text-sky-500">${x(this.price,u`<i class="text-sm mdi mdi-loading"></i>`)} FTM</span><div class="text-sm text-gray-500">Vote price <i class="text-sm mdi mdi-help-circle-outline"></i></div></div></div><div slot="bottom" class="mx-4 grid grid-cols-1 text-center">${P(!this.pending,()=>u`<ui-button class="mt-1 w-full" @click="${this.vote}">Vote</ui-button><ui-button class="mt-1 w-full" ?disabled="${this.retreatDisabled}" @click="${this.retreat}">Retreat</ui-button><div class="text-sm text-gray-500">Retreat price: ${x(this.retreatPrice,u`<i class="text-sm mdi mdi-loading"></i>`)} FTM</div>`,()=>u`<tx-state .tx="${this.tx}" .opts="${{state:{success:"Success. Your vote has been submit."}}}"><ui-button slot="view" @click="${this.close}">Close</ui-button></tx-state>`)}</div></ui-dialog>`}};n([w({type:String})],c.prototype,"album",2);n([w({type:String})],c.prototype,"url",2);n([w({type:String})],c.prototype,"name",2);n([w({type:String})],c.prototype,"author",2);n([w({type:Promise})],c.prototype,"votes",2);n([d()],c.prototype,"myVotes",2);n([d()],c.prototype,"price",2);n([d()],c.prototype,"retreatPrice",2);n([d()],c.prototype,"retreatDisabled",2);n([d()],c.prototype,"socialName",2);n([d()],c.prototype,"socialURI",2);n([d()],c.prototype,"socialID",2);n([d()],c.prototype,"socialVerified",2);n([d()],c.prototype,"tx",2);n([d()],c.prototype,"success",2);n([d()],c.prototype,"pending",2);n([d()],c.prototype,"rewards",2);n([d()],c.prototype,"err",2);c=n([A("vote-album-dialog")],c);const gt=":host::part(dialog-container){padding-left:1rem;padding-right:1rem;padding-top:.5rem;font-size:1rem;line-height:1.5rem;min-height:100px}:host::part(dialog-header){min-height:0}:host::part(dialog-body){min-height:0}:host::part(dialog-footer){min-height:0}";var vt=Object.defineProperty,wt=Object.getOwnPropertyDescriptor,F=(t,e,o,r)=>{for(var s=r>1?void 0:r?wt(e,o):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(s=(r?a(e,o,s):a(s))||s);return r&&s&&vt(e,o,s),s};let C=class extends R([W.styles,gt]){constructor(){super(...arguments),this.button=!1,this.el$=K()}onClose(){this.emit("close")}refClose(){var t;(t=this.el$.value)==null||t.close()}render(){return u`<ui-dialog ${X(this.el$)} @close="${this.onClose}"><slot slot="header" name="header" class="font-bold"></slot><slot></slot>${P(this.button,()=>u`<div slot="footer" class="w-full flex justify-between gap-4"><div></div><div><ui-button text @click="${this.refClose}">Close</ui-button></div></div>`)}</ui-dialog>`}};F([w({type:Boolean})],C.prototype,"button",2);C=F([A("ui-prompt")],C);export{St as a,it as b,at as m,st as r,S as t,$t as w};
