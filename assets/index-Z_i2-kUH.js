import{g as j,T as y,b as v}from"./index-4Y4c3ejC.js";import{t as $,b as V,m as A}from"./dialog-LgBw_VA5.js";import{c as b,e as T,a0 as O,x as i,d as P,n as p,q as w,K as g,h as o,a as m,b as x}from"./vendor-aecOC4Ab.js";import"./icon-C9bbqVue.js";const E=async t=>{let e=`{
    subject ( id: "${t}" ) {
      address createdAt
      fansNumber id image lastVoteAt name supply totalVoteValue
      uri volumeRetreat volumeTotal volumeVote
      creator {
        address id rewardClaimed
        socials { uri pid id platform }
      }
    }
  }`;return await j("MediaBoard",e)},M=async t=>{let e=`{
    subject ( id: "${t}" ) {
      address createdAt volumeTotal volumeVote
      fansNumber id image lastVoteAt name supply totalVoteValue uri volumeRetreat 
      creator {
        address id rewardClaimed socials { uri pid id platform }
      }
      userVotes (orderBy: "volumeTotal" orderDirection: "desc" ) {
        volumeRetreat volumeTotal volumeVote votes
        user { address rewardClaimed }
      }
    }
  }`;return await j("MediaBoard",e)},_=".ui-list .item{cursor:pointer;align-items:center}@media (min-width: 768px){.ui-list .name{font-size:1rem;line-height:1.5rem}}";var C=Object.defineProperty,D=Object.getOwnPropertyDescriptor,h=(t,e,r,a)=>{for(var s=a>1?void 0:a?D(e,r):e,d=t.length-1,c;d>=0;d--)(c=t[d])&&(s=(a?c(e,r,s):c(s))||s);return a&&s&&C(e,r,s),s};let u=class extends y(_){constructor(){super(...arguments),this.bindBridge=new b(this,v),this.weekly=!1,this.trackAddress="",this.subjectData={},this.voteList=[],this.pending=!1,this.prompt=!1,this.promptMessage="",this.init=async()=>{this.pending=!0;try{let t=await M(this.trackAddress);this.voteList=t.subject.userVotes,this.subjectData=t.subject}catch(t){console.error(t),this.promptMessage=t,this.prompt=!0;return}this.pending=!1},this.close=()=>{this.init()},this.go2=t=>{this.disabled?T.emit("connect-wallet"):O(`/user/${t.user.address}`)}}get disabled(){return!v.bridge.account}connectedCallback(){super.connectedCallback(),this.init()}getRandomInt(t){return Math.floor(Math.random()*t)}render(){return i`<div role="list" class="ui-list ${P(this.$c([this.pending?"loading":"hover"]))}"><div class="flex header"><div class="w-16">Rank</div><div class="address flex-auto">Addr</div><div class="num flex-none">Comsumption</div><div class="num flex-none w-28">Earning</div></div>${p(this.pending,()=>i`<div name="Loading" class="doc-intro"><div class="flex flex-col gap-8 m-6">${w([...Array(3).keys()],()=>i`<div name="Loading" class="doc-intro"><loading-skeleton num="4"></loading-skeleton></div>`)}</div></div>`,()=>i`${w(this.voteList,(t,e)=>i`<div class="item flex py-2.5" @click="${()=>this.go2(t)}"><div class="flex-none w-16 pl-4 text-sm font-light opacity-70">${e+1}</div><div class="flex-auto"><ui-address .address="${t.user.address}" short avatar class="text-base"></ui-address></div><div class="num flex-none"><p class="name truncate mt-2">${g(t.volumeVote,18)}</p></div><div class="num flex-none w-28"><p class="name truncate mt-2">${g(t.user.rewardClaimed,18)}</p></div></div>`)}`)}</div>${p(this.prompt,()=>i`<p class="text-center text-orange-600">${this.promptMessage}</p>`)}`}};h([m({type:Boolean})],u.prototype,"weekly",2);h([m({type:String})],u.prototype,"trackAddress",2);h([o()],u.prototype,"subjectData",2);h([o()],u.prototype,"voteList",2);h([o()],u.prototype,"pending",2);h([o()],u.prototype,"prompt",2);h([o()],u.prototype,"promptMessage",2);u=h([x("voter-list")],u);var L=Object.defineProperty,S=Object.getOwnPropertyDescriptor,n=(t,e,r,a)=>{for(var s=a>1?void 0:a?S(e,r):e,d=t.length-1,c;d>=0;d--)(c=t[d])&&(s=(a?c(e,r,s):c(s))||s);return a&&s&&L(e,r,s),s};const R=()=>({tx:""});let l=class extends y(_){constructor(){super(...arguments),this.bindBridge=new b(this,v),this.bindTweets=new b(this,$),this.weekly=!1,this.trackAddress="",this.subject={totalVoteValue:"0"},this.voteList=[],this.pending=!1,this.prompt=!1,this.dialog=!1,this.promptMessage="",this.err=R(),this.actionType="",this.ts=0,this.updateErr=(t={})=>this.err=Object.assign({},this.err,t),this.init=async()=>{this.pending=!0;try{let t=await E(this.trackAddress);this.subject=t.subject,await this.getPrice(),await this.readFromTwitter()}catch(t){this.promptMessage=t,this.prompt=!0}finally{this.ts++,this.pending=!1}},this.close=()=>{this.dialog=!1,this.init()},this.setAction=t=>this.actionType=t,this.popAction=(t="vote")=>{t==this.actionType&&this.dialog||!this[`${t}Enable`]||(this.setAction(t),this.dialog=!0)},this.open=()=>window.open(`${this.subject.uri}`,"_blank")}get disabled(){return!v.bridge.account}get voteEnable(){return this.ts&&!this.disabled}get retreatEnable(){return this.ts&&+g(this.myVotes,0)>0}connectedCallback(){super.connectedCallback(),this.init()}getRandomInt(t){return Math.floor(Math.random()*t)}async readFromTwitter(){const{uri:t}=this.subject.creator.socials[0]??{},e=await $.get(t);e&&Object.assign(e,{verified:e.address.includes(this.subject.creator.address)}),this.social=e}async getPrice(){try{this.votes=V(this.trackAddress).then(t=>t[4]),this.myVotes=await A(this.trackAddress).then(t=>t)}catch(t){let e=t.message||t.code;this.updateErr({tx:e})}}render(){return i`<div>${p(this.pending&&!this.subject,()=>i`<div name="Loading" class="doc-intro"><div class="flex flex-col gap-8 m-8"><loading-skeleton num="3"></loading-skeleton></div></div>`,()=>i`<div class="grid lg_grid-cols-13 gap-2"><div class="lg_col-span-6 flex gap-6"><div class="w-32 h-32 rounded-xl bg-white/10"><img-loader src="${this.subject.image}" class="w-32 h-32 rounded-xl"></img-loader></div><div class="flex flex-col justify-start ml-4"><div class="text-xl mb-1.5">${this.subject.name??"-"}</div>${p(this.social,()=>{var t,e,r,a;return i`<div class="inline-flex text-base font-normal mb-0.5">${(t=this.social)==null?void 0:t.name} ${p((e=this.social)==null?void 0:e.verified,()=>i`<span class="ml-0.5"><i class="mdi mdi-check-decagram text-sm text-green-600"></i></span>`)}</div><a class="text-base font-normal text-blue-300" href="${(r=this.social)==null?void 0:r.url}" target="_blank">@${(a=this.social)==null?void 0:a.id}</a>`},()=>i`-`)} ${p(this.subject.uri,()=>i`<div class="my-1"><ui-button icon lg @click="${this.open}"><i class="mdi mdi-play-circle-outline"></i></ui-button></div>`)}<div class="mt-2 flex gap-3">${p(this.voteEnable,()=>i`<ui-button sm class="outlined" ?disabled="${!this.voteEnable}" @click="${()=>this.popAction("vote")}">VOTE</ui-button>`)} ${p(this.retreatEnable,()=>i`<ui-button sm class="outlined" ?disabled="${!this.retreatEnable}" @click="${()=>this.popAction("retreat")}">RETREAT</ui-button>`)} ${p(this.dialog,()=>{var t;return i`<vote-album-dialog action="${this.actionType}" album="${this.subject.id}" url="${this.subject.image}" name="${this.subject.name}" votes="${this.subject.supply}" author="${(t=this.subject.creator)==null?void 0:t.address}" @close="${this.close}"></vote-album-dialog>`})}</div></div></div><div class="lg_col-start-7 lg_col-span-7 grid grid-cols-6 lg_grid-cols-8 gap-4 place-items-center items-center"><div class="lg_col-start-3 col-span-2 flex flex-col justify-center items-center w-full h-4/5 bg-white/5 rounded-xl gap-1.5"><div class="text-base text-gray-500 align-center">Voters</div><div class="text-4xl align-center lining-nums">${this.subject.fansNumber}</div></div><div class="col-span-2 flex flex-col justify-center items-center w-full h-4/5 bg-white/5 rounded-xl gap-1.5"><div class="text-base text-gray-500 align-center">Tickets</div><div class="text-4xl align-center lining-nums">${this.subject.supply}</div></div><div class="col-span-2 flex flex-col justify-center items-center w-full h-4/5 bg-white/5 rounded-xl gap-1.5"><div class="text-base text-gray-500 align-center">Total Vote Value</div><div class="text-4xl align-center lining-nums">${g(this.subject.totalVoteValue,18)}</div></div></div></div>`)}</div>${p(this.prompt,()=>i`<p class="text-center text-orange-600">${this.promptMessage}</p>`)}`}};n([m({type:Boolean})],l.prototype,"weekly",2);n([m({type:String})],l.prototype,"trackAddress",2);n([m({type:Promise})],l.prototype,"votes",2);n([o()],l.prototype,"myVotes",2);n([o()],l.prototype,"social",2);n([o()],l.prototype,"subject",2);n([o()],l.prototype,"voteList",2);n([o()],l.prototype,"pending",2);n([o()],l.prototype,"prompt",2);n([o()],l.prototype,"dialog",2);n([o()],l.prototype,"promptMessage",2);n([o()],l.prototype,"err",2);n([o({type:String})],l.prototype,"actionType",2);n([o()],l.prototype,"ts",2);l=n([x("track-detail")],l);const B="";var N=Object.defineProperty,I=Object.getOwnPropertyDescriptor,k=(t,e,r,a)=>{for(var s=a>1?void 0:a?I(e,r):e,d=t.length-1,c;d>=0;d--)(c=t[d])&&(s=(a?c(e,r,s):c(s))||s);return a&&s&&N(e,r,s),s};let f=class extends y(B){constructor(){super(...arguments),this.addr=""}render(){return i`<div class="ui-container mx-auto flex flex-col place-content-center pt-12"><track-detail trackAddress="${this.addr}"></track-detail><div class="mt-14"><div class="w-full inline-flex pb-6 border-b border-slate-50/10"><div class="py-1.5 px-3 text-base font-normal bg-sky-300/10 text-white/70 rounded-md">Voters</div></div><voter-list trackAddress="${this.addr}"></voter-list></div></div>`}};k([m({type:String})],f.prototype,"addr",2);f=k([x("track-page")],f);export{f as TrackPage};
